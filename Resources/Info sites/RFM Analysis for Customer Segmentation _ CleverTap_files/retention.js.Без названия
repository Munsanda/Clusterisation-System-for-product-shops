jQuery(document).ready(function($){let custStart=0;let custEnd=0;let custAcquired=0;let timeVal=1;let retentionBtnClicked=false;let dollarBtnClicked=false;function calcRetention(){const inputsValid=requiredInputsHaveValues('.percent-rate-calc input[required]');if(!inputsValid||!retentionBtnClicked){$('.percent-rate-calc .current, .percent-rate-calc .annual').addClass('transparent');return;}
custEnd=parseInt($('#customers1').val());custAcquired=parseInt($('#customers2').val());custStart=parseInt($('#customers3').val());let custGrowth=custEnd-custStart;const growthR=(custGrowth/custStart)*100;let custChurn=custEnd-custAcquired-custStart;if(custChurn>0){custChurn=0;}else{custChurn=Math.abs(custChurn);}
const churnR=(custChurn/custStart)*100;const retentionR=((custEnd-custAcquired)/custStart)*100;var rVals={custGrowth:custGrowth,growthR:growthR,churnR:churnR,custChurn:custChurn,retentionR:retentionR}
displayRetention(rVals);calcDlrRetention()}
function formattedPercent(val){const round=Math.round(val*100)/100;return round.toLocaleString()+'%';}
function formattedNum(val){const round=Math.round(val);return round.toLocaleString();}
function displayRetention(rVals){var annualMult=12/timeVal;$('.percent-rate-results .current, .percent-rate-results .annual').removeClass('transparent');$('#custGrowth .current').text(formattedNum(rVals.custGrowth));$('#custGrowth .annual').text(formattedNum(rVals.custGrowth*annualMult));$('#growthR .current, #growthR .annual').text(formattedPercent(rVals.growthR));$('#retentionR .current, #retentionR .annual').text(formattedPercent(rVals.retentionR));$('#churnR .current, #churnR .annual').text(formattedPercent(rVals.churnR));$('#custChurn .current').text(formattedNum(rVals.custChurn));$('#custChurn .annual').text(formattedNum(rVals.custChurn*annualMult));}
$('#time-period').click(function(){if($('.dropdown-select').hasClass('open')){$('.dropdown-select').removeClass('open').slideUp('fast');}else{$('.dropdown-select').slideDown(300,function(){$('.dropdown-select').addClass('open');})}})
$('#time-period .dropdown-select li').click(function(){timeVal=parseInt($(this).data('multiply'));var timePeriod=$(this).text();$(this).siblings().removeClass('active');$(this).addClass('active');$('#time-period .time-text').text(timePeriod);calcRetention();})
$('.percent-rate-calc input').keyup(function(){calcRetention();});$('.percent-rate-calc .calculate-btn').click(function(){retentionBtnClicked=true;calcRetention();});function requiredInputsHaveValues(selector){let valid=true;const inputs=$(selector);for(let i=0;i<inputs.length;i++){if($(inputs[i]).val().length<=0){valid=false;break;}}
return valid;}
function calcDlrRetention(){const inputsValid=requiredInputsHaveValues(['#retention-calc input[required]']);if(!inputsValid||!dollarBtnClicked||!retentionBtnClicked){$('.dollar-rate-results .current, .dollar-rate-results .annual').addClass('transparent');return;}
var avgEnd=parseInt($('#dollars2').val());var profitMargin=parseInt($('#dollars3').val())/100;var dlrRetained=(custEnd-custAcquired)*avgEnd;var profitRetained=profitMargin*dlrRetained;var dVals={dlrRetained:dlrRetained,profitRetained:profitRetained}
displayDlrRetention(dVals);}
function formattedDval(val){if(val>=0){val=Math.round(Number.parseFloat(val));return '$'+val.toLocaleString();}else{val=Math.round(Number.parseFloat(val))*-1;return '-$'+val.toLocaleString();}}
function displayDlrRetention(dVals){var annualMult=12/timeVal;$('.dollar-rate-results .current, .dollar-rate-results .annual').removeClass('transparent');$('#dlrGrowth .current').text(formattedDval(dVals.dlrRetained));$('#dlrGrowth .annual').text(formattedDval(dVals.dlrRetained*annualMult));$('#dlrLoss .current').text(formattedDval(dVals.profitRetained));$('#dlrLoss .annual').text(formattedDval(dVals.profitRetained*annualMult));}
$('.dollar-rate-calc input').keyup(function(){calcDlrRetention();});$('.dollar-rate-calc .calculate-btn').click(function(){dollarBtnClicked=true;calcDlrRetention();});})